{"version":3,"file":"js/209.50083a699c969db44d99.js","mappings":"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","sources":["webpack:///./node_modules/@redhat-cloud-services/frontend-components/esm/useChrome/useChrome.js","webpack:///./src/Navigation.ts","webpack:///./src/Utils/constants.ts","webpack:///./node_modules/@babel/runtime/helpers/esm/defineProperty.js"],"sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useScalprum } from '@scalprum/react-core';\n\nvar useChrome = function useChrome(selector) {\n  var _state$api;\n\n  var state = useScalprum();\n  var chrome = ((_state$api = state.api) === null || _state$api === void 0 ? void 0 : _state$api.chrome) || {};\n  chrome = _objectSpread(_objectSpread({}, chrome), {}, {\n    initialized: state.initialized\n  });\n\n  if (typeof selector === 'function') {\n    return selector(chrome);\n  }\n\n  return chrome;\n};\n\nexport default useChrome;","import * as React from 'react';\nimport { activePlugins } from './Utils/constants';\nimport { HrefNavItem, NavSection } from '@console/dynamic-plugin-sdk/src';\nimport { EnabledPlugin } from '@console/mount/src/components/plugins/IncludePlugins';\nimport { Extension } from '@console/dynamic-plugin-sdk/src/types';\nimport { ConsolePluginManifestJSON } from '@console/dynamic-plugin-sdk/src/schema/plugin-manifest';\nimport useChrome from '@redhat-cloud-services/frontend-components/useChrome';\n\nexport interface RouteProps {\n  isHidden?: boolean;\n  appId?: string;\n  href?: string;\n  title?: string;\n}\n\nexport interface DynamicNav {\n  dynamicNav: string;\n  currentNamespace: string;\n  base?: string;\n}\n\nconst navExtensionTypes = ['console.navigation/href', 'console.navigation/section'];\ntype NavExtension = HrefNavItem | NavSection;\n\nexport type GetAllExtensions = (base?: string) => Promise<NavExtension[]>;\nexport type CalculateRoutes = (navIdentifier: [string, string], currentNamespace: string, extensions: (HrefNavItem | NavSection)[]) => RouteProps[];\nexport type Navigation = {\n  expandable: boolean;\n  title: string;\n  routes: RouteProps[];\n};\n\nconst isFulfilledPromise = (result: PromiseSettledResult<Extension[]>): result is PromiseFulfilledResult<Extension[]> => {\n  return result.status === 'fulfilled' && Boolean(result.value);\n};\n\nconst isNavItem = (extension: Extension): extension is NavExtension => {\n  return navExtensionTypes.includes(extension.type);\n};\n\nconst getAllExtensions: GetAllExtensions = async (base = '') => {\n  const results: PromiseSettledResult<Extension[]>[] = await Promise.allSettled(\n    activePlugins.flatMap(async ({ name: pluginName, pathPrefix = '/api/plugins' }: EnabledPlugin) => {\n      const url = `${base}${pathPrefix}/${pluginName}/plugin-manifest.json`;\n      const response: Response = await fetch(url);\n      if (response.status !== 200) {\n        const msg = `${url} - ${response.status} - ${response.statusText}`;\n        // eslint-disable-next-line no-console\n        console.error(msg);\n        throw new Error(msg);\n      }\n      const manifest: ConsolePluginManifestJSON = await response.json();\n      return manifest.extensions;\n    }),\n  );\n\n  return results\n    .filter(isFulfilledPromise)\n    .map(({ value }) => value)\n    .flat()\n    .filter(isNavItem);\n};\n\nconst calculateRoutes: CalculateRoutes = ([appId, navSection], currentNamespace, extensions) => {\n  return extensions\n    .filter(({ type, properties }: HrefNavItem) => type.includes('console.navigation/href') && properties.section === navSection)\n    .map((extension: HrefNavItem) => ({\n      appId,\n      href: `/${currentNamespace}${navSection ? `/${navSection}` : ''}${extension.properties.href}`,\n      title: extension.properties.name,\n    }));\n};\n\nconst calculateNavigation = async ({ dynamicNav, currentNamespace, base }: DynamicNav): Promise<Navigation | RouteProps[]> => {\n  const [appId, navSection] = dynamicNav.split('/');\n  let allExtensions: NavExtension[] = [];\n  let routes: RouteProps | RouteProps[];\n  try {\n    allExtensions = await getAllExtensions(base);\n    routes = calculateRoutes([appId, navSection], currentNamespace, allExtensions);\n    if (routes.length === 0) {\n      routes = [{ isHidden: true }];\n    }\n  } catch (e) {\n    routes = [{ isHidden: true }];\n    // eslint-disable-next-line no-console\n    console.error('Problem fetching extensions', e);\n  }\n  const { properties: currSection } =\n    allExtensions.find(({ type, properties }: NavSection) => type === 'console.navigation/section' && properties.id === navSection) || {};\n  return currSection\n    ? {\n        expandable: true,\n        title: currSection.name,\n        routes,\n      }\n    : routes;\n};\n\nexport const useNavigation = ({ dynamicNav, currentNamespace }: DynamicNav): Navigation | RouteProps[] => {\n  const [navigation, setNavigation] = React.useState<Navigation | RouteProps[]>();\n  const unmounted = React.useRef<boolean>(false);\n  const { isBeta } = useChrome();\n  React.useEffect(() => {\n    if (dynamicNav) {\n      // this is just one off for now, but we can start building on this\n      calculateNavigation({ dynamicNav, currentNamespace, base: isBeta() ? `/beta` : '' }).then((data: Navigation | RouteProps[]) => {\n        if (!unmounted.current) {\n          setNavigation(data);\n        }\n      });\n    }\n\n    return () => {\n      unmounted.current = true;\n    };\n  }, [dynamicNav, currentNamespace]);\n\n  return navigation;\n};\n\nexport default calculateNavigation;\n","export const activePlugins = [{ name: 'console-demo-plugin' }, { name: 'sources', pathPrefix: '/apps' }];\n","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}"],"names":["ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","selector","_state$api","state","useScalprum","chrome","api","initialized","navExtensionTypes","isFulfilledPromise","result","status","Boolean","value","isNavItem","extension","includes","type","calculateNavigation","dynamicNav","currentNamespace","base","appId","navSection","split","routes","allExtensions","Promise","allSettled","name","pluginName","pathPrefix","url","response","fetch","msg","statusText","console","error","Error","json","extensions","map","flat","getAllExtensions","properties","section","href","title","calculateRoutes","isHidden","e","currSection","find","id","expandable","useNavigation","navigation","setNavigation","unmounted","isBeta","then","data","current","activePlugins","_defineProperty","obj","configurable","writable"],"sourceRoot":""}